{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Here ‑ Nike's Catering Services</title>

    <!-- STYLES -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/bookhere.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
{% include 'navbar.html' %}

<!-- ===============   PROGRESS BAR AT TOP   =============== -->
<div class="wizard-progress-header">
    <div class="container">
        <div class="step-progress-bar">
            {% for s in "01234567" %}
                <div class="step" data-step="{{ forloop.counter0 }}">
                    <div class="step-icon">
                        {% if forloop.counter0 == 0 %}<i class="fa-solid fa-user"></i>{% endif %}
                        {% if forloop.counter0 == 1 %}<i class="fa-regular fa-calendar"></i>{% endif %}
                        {% if forloop.counter0 == 2 %}<i class="fa-regular fa-clipboard"></i>{% endif %}
                        {% if forloop.counter0 == 3 %}<i class="fa-solid fa-users"></i>{% endif %}
                        {% if forloop.counter0 == 4 %}<i class="fa-solid fa-location-dot"></i>{% endif %}
                        {% if forloop.counter0 == 5 %}<i class="fa-solid fa-palette"></i>{% endif %}
                        {% if forloop.counter0 == 6 %}<i class="fa-solid fa-box"></i>{% endif %}
                        {% if forloop.counter0 == 7 %}<i class="fa-solid fa-utensils"></i>{% endif %}
                    </div>
                    <div class="step-circle"><span class="step-check"><i class="fa fa-check"></i></span></div>
                    <div class="step-label">
                        {% if forloop.counter0 == 0 %}Celebrant{% endif %}
                        {% if forloop.counter0 == 1 %}Date of Event{% endif %}
                        {% if forloop.counter0 == 2 %}Type of Event{% endif %}
                        {% if forloop.counter0 == 3 %}Number of Pax{% endif %}
                        {% if forloop.counter0 == 4 %}Location{% endif %}
                        {% if forloop.counter0 == 5 %}Color Motif{% endif %}
                        {% if forloop.counter0 == 6 %}Packages{% endif %}
                        {% if forloop.counter0 == 7 %}Food Menu{% endif %}
                    </div>
                </div>
                {% if not forloop.last %}<div class="step-line"></div>{% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- ===============   MAIN WIZARD CONTAINER   =============== -->
<div class="wizard-container">
    
    <!-- ========================================================= -->
    <!--                       STEP 0 – CELEBRANT                  -->
    <!-- ========================================================= -->
    <div id="step-0" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">What's the celebrant's name?</h3>
                <p class="step-subtitle">Let's start with the basics</p>
            </div>
            
            <div id="alert-name" class="alert alert-danger d-none"></div>
            
            <form id="name-form" class="step-form" autocomplete="off">
                <div class="form-group">
                    <input type="text" id="celebrant-name" class="form-control step-input" 
                           required placeholder="Enter full name">
                </div>
                
                <div class="step-navigation">
                    <button type="submit" class="btn btn-primary next-btn">
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                       STEP 1 – DATE                       -->
    <!-- ========================================================= -->
    <div id="step-1" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">When is your event?</h3>
                <p class="step-subtitle">Hey there! I'm Patrice — your go‑to buddy for planning awesome events. So, what date are we looking at for your event?</p>
            </div>
            
            <div id="alert-date" class="alert alert-danger d-none"></div>
            
            <form id="date-form" class="step-form" autocomplete="off">
                <div class="form-group">
                    <input type="date" id="date-picker" class="form-control step-input" required>
                </div>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary next-btn">
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                     STEP 2 – EVENT TYPE                    -->
    <!-- ========================================================= -->
    <div id="step-2" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">What type of event?</h3>
                <p class="step-subtitle">Great! Now, what type of event would you like to plan?</p>
            </div>
            
            <div id="alert-event" class="alert alert-danger d-none"></div>
            
            <div class="step-form">
                <div class="form-group">
                    <div class="event-btn-group">
                        <button type="button" class="event-btn">Kiddie Party</button>
                        <button type="button" class="event-btn">Birthday Party</button>
                        <button type="button" class="event-btn">Wedding</button>
                        <button type="button" class="event-btn">Christening</button>
                    </div>
                    
                    <form id="custom-event-form" class="custom-event-form" autocomplete="off">
                        <input type="text" class="form-control custom-event-input" 
                               placeholder="Or type your custom event type…">
                        <button type="submit" class="btn btn-outline-primary custom-event-submit">
                            Submit Custom Event
                        </button>
                    </form>
                </div>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="button" class="btn btn-primary next-btn" id="event-next-btn" disabled>
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                     STEP 3 – PAX                           -->
    <!-- ========================================================= -->
    <div id="step-3" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">Number of guests</h3>
                <p class="step-subtitle">Great! Now, please tell me the number of guests (pax) for your event.</p>
            </div>
            
            <div id="alert-pax" class="alert alert-danger d-none"></div>
            
            <form id="pax-form" class="step-form" autocomplete="off">
                <div class="form-group">
                    <select id="pax-select" class="form-control step-input" required>
                        <option value="" disabled selected>--Select Number of Guests--</option>
                        <option value="70">70 pax</option>
                        <option value="80">80 pax</option>
                        <option value="100">100 pax</option>
                        <option value="120">120 pax</option>
                        <option value="150">150 pax</option>
                        <option value="200">200 pax</option>
                        <option value="250">250 pax</option>
                    </select>
                </div>

                <form id="custom-pax-form" class="custom-pax-form" autocomplete="off">
                    <input type="number" class="form-control custom-pax-input" 
                           placeholder="Or type custom number" min="1">
                    <button type="submit" class="btn btn-outline-primary custom-pax-submit">
                        Submit Custom
                    </button>
                </form>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary next-btn">
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                  STEP 4 – LOCATION                         -->
    <!-- ========================================================= -->
    <div id="step-4" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">Event location</h3>
                <p class="step-subtitle">Please enter the venue name and upload a floor plan.</p>
            </div>
            
            <div id="alert-location" class="alert alert-danger d-none"></div>
            
            <form id="location-form" class="step-form" enctype="multipart/form-data">
                <div class="form-group">
                    <input type="text" id="venue-input" class="form-control step-input" 
                           placeholder="Venue name..." required>
                </div>
                
                <div class="form-group">
                    <label for="wizard-floorplan" class="form-label">Upload Floor Plan:</label>
                    <input type="file" id="wizard-floorplan" class="form-control" accept="image/*">
                    <img id="floorplan-preview" class="floor-plan-preview" style="display:none;">
                </div>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary next-btn">
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                    STEP 5 – COLOR                          -->
    <!-- ========================================================= -->
    <div id="step-5" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">Color motif</h3>
                <p class="step-subtitle">Choose a color motif for your event.</p>
            </div>
            
            <div id="alert-color" class="alert alert-danger d-none"></div>
            
            <form id="color-form" class="step-form" autocomplete="off">
                <div class="form-group">
                    <select id="color-select" class="form-control step-input" required>
                        <option value="" disabled selected>--Select Color--</option>
                        <option value="Red">Red</option>
                        <option value="Blue">Blue</option>
                        <option value="Green">Green</option>
                        <option value="Yellow">Yellow</option>
                        <option value="Pink">Pink</option>
                        <option value="Purple">Purple</option>
                        <option value="Orange">Orange</option>
                        <option value="Teal">Teal</option>
                        <option value="Brown">Brown</option>
                        <option value="Black">Black</option>
                        <option value="White">White</option>
                        <option value="Gray">Gray</option>
                        <option value="Gold">Gold</option>
                        <option value="Silver">Silver</option>
                        <option value="Maroon">Maroon</option>
                        <option value="Navy">Navy</option>
                        <option value="Lavender">Lavender</option>
                        <option value="Magenta">Magenta</option>
                        <option value="Cyan">Cyan</option>
                        <option value="Olive">Olive</option>
                        <option value="Coral">Coral</option>
                        <option value="Turquoise">Turquoise</option>
                        <option value="Peach">Peach</option>
                        <option value="Beige">Beige</option>
                        <option value="Mint">Mint</option>
                        <option value="Plum">Plum</option>
                        <option value="Indigo">Indigo</option>
                        <option value="Sky Blue">Sky Blue</option>
                        <option value="Khaki">Khaki</option>
                        <option value="Charcoal">Charcoal</option>
                        <option value="Rose">Rose</option>
                    </select>
                </div>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="submit" class="btn btn-primary next-btn">
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--                 STEP 6 – PACKAGE                           -->
    <!-- ========================================================= -->
    <div id="step-6" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">Choose your package</h3>
                <p class="step-subtitle">You selected: <span id="package-summary">Wedding 180 Pax</span></p>
            </div>
            
            <div id="alert-package" class="alert alert-danger d-none"></div>
            
            <div class="step-form">
                <div class="form-group text-center">
                    <img id="package_img" src="https://i.ibb.co/6b7Qw8d/sample-package.jpg" alt="Package Sample"
                         class="package-preview-img">
                </div>
                
                <div class="form-group">
                    <div class="package-btn-group">
                        <button type="button" class="package-choice-btn">Package A</button>
                        <button type="button" class="package-choice-btn">Package B</button>
                        <button type="button" class="package-choice-btn">Package C</button>
                    </div>
                </div>
                
                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="button" class="btn btn-primary next-btn" id="package-next-btn" disabled>
                        Next <i class="fa fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========================================================= -->
    <!--               STEP 7 – FOOD‑MENU (FINAL)                   -->
    <!-- ========================================================= -->
    <div id="step-7" class="wizard-step" style="display:none;">
        <div class="step-form-container">
            <div class="step-header">
                <h3 class="step-title">Select your menu</h3>
                <p class="step-subtitle">Please select <strong>4 dishes total</strong> + 1 pasta + 1 drink:</p>
            </div>
            
            <div id="alert-food" class="alert alert-danger d-none"></div>
            
            <form id="foodmenu-form" class="step-form" autocomplete="off">
                <!-- Beef -->
                <div class="food-section" data-group="beef">
                    <div class="food-section-label">Beef</div>
                    <div class="food-btn-group" data-limit="4">
                        <button type="button" class="food-btn">Beef Broccoli</button>
                        <button type="button" class="food-btn">Beef Caldereta</button>
                        <button type="button" class="food-btn">Beef Kare‑Kare</button>
                        <button type="button" class="food-btn">Beef Teriyaki</button>
                        <button type="button" class="food-btn">Beef with Gravy Sauce</button>
                        <button type="button" class="food-btn">Garlic Beef</button>
                        <button type="button" class="food-btn">Lengua Pastel</button>
                        <button type="button" class="food-btn">Pot‑Roast Beef</button>
                    </div>
                </div>

                <!-- Pork -->
                <div class="food-section" data-group="pork">
                    <div class="food-section-label">Pork</div>
                    <div class="food-btn-group" data-limit="4">
                        <button type="button" class="food-btn">Grilled Liempo</button>
                        <button type="button" class="food-btn">Hawaiian Spareribs</button>
                        <button type="button" class="food-btn">Kare‑Kare Bagnet</button>
                        <button type="button" class="food-btn">Lechon Kawali</button>
                        <button type="button" class="food-btn">Lengua Pastel</button>
                        <button type="button" class="food-btn">Lumpiang Shanghai</button>
                        <button type="button" class="food-btn">Pork BBQ</button>
                        <button type="button" class="food-btn">Pork Caldereta</button>
                        <button type="button" class="food-btn">Pork Hamonado</button>
                        <button type="button" class="food-btn">Pork Menudo</button>
                        <button type="button" class="food-btn">Pork Morcon</button>
                        <button type="button" class="food-btn">Pork Teriyaki</button>
                        <button type="button" class="food-btn">Roast Pork Hawaiian</button>
                        <button type="button" class="food-btn">Roast Pork with Raisin Sauce</button>
                    </div>
                </div>

                <!-- Chicken -->
                <div class="food-section" data-group="chicken">
                    <div class="food-section-label">Chicken</div>
                    <div class="food-btn-group" data-limit="4">
                        <button type="button" class="food-btn">Breaded Fried Chicken</button>
                        <button type="button" class="food-btn">Buttered Chicken</button>
                        <button type="button" class="food-btn">Chicken BBQ</button>
                        <button type="button" class="food-btn">Chicken Cordon Bleu</button>
                        <button type="button" class="food-btn">Chicken Lollipop</button>
                        <button type="button" class="food-btn">Chicken Pastel</button>
                        <button type="button" class="food-btn">Chicken Teriyaki</button>
                        <button type="button" class="food-btn">Honey Glazed Chicken</button>
                        <button type="button" class="food-btn">Hongkong Chicken</button>
                        <button type="button" class="food-btn">Orange Chicken with Lemon Sauce</button>
                        <button type="button" class="food-btn">Royal Chicken</button>
                    </div>
                </div>

                <!-- Seafood -->
                <div class="food-section" data-group="seafood">
                    <div class="food-section-label">Seafood</div>
                    <div class="food-btn-group" data-limit="4">
                        <button type="button" class="food-btn">Calamares</button>
                        <button type="button" class="food-btn">Fish Fillet with Chili Sauce</button>
                        <button type="button" class="food-btn">Fish Fillet with Tartar Sauce</button>
                        <button type="button" class="food-btn">Fish Tofu</button>
                        <button type="button" class="food-btn">Mixed Seafoods with Vegetables</button>
                        <button type="button" class="food-btn">Squid with Lemon Sauce</button>
                        <button type="button" class="food-btn">Tempura</button>
                    </div>
                </div>

                <!-- Vegetables -->
                <div class="food-section" data-group="vegetables">
                    <div class="food-section-label">Vegetables</div>
                    <div class="food-btn-group" data-limit="4">
                        <button type="button" class="food-btn">Buttered Mixed Vegetables</button>
                        <button type="button" class="food-btn">Chopsuey in White Sauce</button>
                        <button type="button" class="food-btn">Chopsuey in Oyster Sauce</button>
                        <button type="button" class="food-btn">Lumpiang Sariwa</button>
                        <button type="button" class="food-btn">Oriental Mixed Vegetables</button>
                        <button type="button" class="food-btn">Stir Fry Vegetables</button>
                    </div>
                </div>

                <!-- Pasta -->
                <div class="food-section" data-group="pasta">
                    <div class="food-section-label">Please select 1 pasta:</div>
                    <div class="food-btn-group" data-limit="1">
                        <button type="button" class="food-btn">Baked Macaroni</button>
                        <button type="button" class="food-btn">Fettuccine Alfredo</button>
                        <button type="button" class="food-btn">Lasagna Rolls</button>
                        <button type="button" class="food-btn">Linguine in White or Red Sauce</button>
                        <button type="button" class="food-btn">Pancit Bihon or Canton</button>
                        <button type="button" class="food-btn">Penne in White or Red Sauce</button>
                        <button type="button" class="food-btn">Rigatoni in White or Red Sauce</button>
                        <button type="button" class="food-btn">Spaghetti</button>
                    </div>
                </div>

                <!-- Drink -->
                <div class="food-section" data-group="drink">
                    <div class="food-section-label">Please select 1 drink:</div>
                    <div class="food-btn-group" data-limit="1">
                        <button type="button" class="food-btn">Blue Lemonade</button>
                        <button type="button" class="food-btn">Cucumber Lemonade</button>
                        <button type="button" class="food-btn">Four Seasons</button>
                        <button type="button" class="food-btn">Lemon Tea</button>
                        <button type="button" class="food-btn">Orange Juice</button>
                        <button type="button" class="food-btn">Pineapple Juice</button>
                        <button type="button" class="food-btn">Red Tea</button>
                    </div>
                </div>

                <div class="step-navigation">
                    <button type="button" class="btn btn-outline-secondary back-btn">
                        <i class="fa fa-arrow-left"></i> Back
                    </button>
                    <button type="submit" class="btn btn-success final-submit-btn">
                        <i class="fa fa-check-circle"></i> Complete Booking
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ----------  HIDDEN FINAL FORM  ---------- -->
<form id="final-booking-form" method="POST" action="{% url 'bookhere_submit' %}" style="display:none;" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="payload" id="booking-payload">
    <input type="file" name="floorplan-payload" id="floorplan-payload" style="display:none;" accept="image/*">
</form>

<!-- ============================================================== -->
<!--                          JAVASCRIPT                             -->
<!-- ============================================================== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
<script>

document.addEventListener('DOMContentLoaded', function() {
    // Initialize date picker
    const datePicker = document.getElementById('date-picker');
    const today = new Date().toISOString().split('T')[0];
    datePicker.setAttribute('min', today);
    datePicker.value = today;
    
    datePicker.addEventListener('keydown', function(e) {
        e.preventDefault();
        return false;
    });
});

// ============================================
//    GLOBAL VARIABLES & UTILITY FUNCTIONS
// ============================================

let currentStep = 0;
const totalSteps = 8;
const answers = [null, null, null, null, null, null, null, null]; // [name, date, event, pax, location, color, package, food]
const bookDetails = new BookDetails();

// Cached form data for navigation
const formCache = {
    celebrantName: '',
    eventDate: '',
    eventType: '',
    numberOfPax: '',
    venue: '',
    floorplan: null,
    colorMotif: '',
    package: '',
    foodSelection: {}
};

class BookDetails {
    constructor(CustomerName, Schedule, TypeOfEvent, NumberOfPax, Location, ColorMotif, Package, ListOfFood) {
        this.CustomerName = CustomerName; 
        this.Schedule = Schedule;
        this.TypeOfEvent = TypeOfEvent;
        this.NumberOfPax = NumberOfPax;
        this.Location = Location;
        this.ColorMotif = ColorMotif;
        this.Package = Package;
        this.ListOfFood = ListOfFood;
    }
}

function showAlert(stepId, msg) {
    const alertDiv = document.getElementById(`alert-${stepId}`);
    if (alertDiv) {
        alertDiv.textContent = msg;
        alertDiv.classList.remove('d-none');
    }
}

function clearAlert(stepId) {
    const alertDiv = document.getElementById(`alert-${stepId}`);
    if (alertDiv) {
        alertDiv.classList.add('d-none');
        alertDiv.textContent = '';
    }
}

function updateStepProgress() {
    document.querySelectorAll('.step').forEach((step, index) => {
        step.classList.remove('active', 'completed');
        
        if (index < currentStep) {
            step.classList.add('completed');
        } else if (index === currentStep) {
            step.classList.add('active');
        }
    });
    
    // Update step lines
    document.querySelectorAll('.step-line').forEach((line, index) => {
        line.classList.toggle('completed', index < currentStep);
    });
}

function showStep(stepIndex) {
    // Hide all steps
    document.querySelectorAll('.wizard-step').forEach(step => {
        step.style.display = 'none';
    });
    
    // Show current step
    const currentStepElement = document.getElementById(`step-${stepIndex}`);
    if (currentStepElement) {
        currentStepElement.style.display = 'block';
    }
    
    // Restore cached data
    restoreFormData(stepIndex);
    
    // Update progress
    currentStep = stepIndex;
    updateStepProgress();
    
    // Scroll to top
    window.scrollTo(0, 0);
}

function restoreFormData(stepIndex) {
    switch(stepIndex) {
        case 0:
            if (formCache.celebrantName) {
                document.getElementById('celebrant-name').value = formCache.celebrantName;
            }
            break;
        case 1:
            if (formCache.eventDate) {
                document.getElementById('date-picker').value = formCache.eventDate;
            }
            break;
        case 2:
            if (formCache.eventType) {
                // Restore event type selection
                document.querySelectorAll('.event-btn').forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.textContent.trim() === formCache.eventType) {
                        btn.classList.add('selected');
                        document.getElementById('event-next-btn').disabled = false;
                    }
                });
                document.querySelector('.custom-event-input').value = 
                    ['Kiddie Party', 'Birthday Party', 'Wedding', 'Christening'].includes(formCache.eventType) ? '' : formCache.eventType;
            }
            break;
        case 3:
            if (formCache.numberOfPax) {
                document.getElementById('pax-select').value = formCache.numberOfPax;
                document.querySelector('.custom-pax-input').value = 
                    ['70', '80', '100', '120', '150', '200', '250'].includes(formCache.numberOfPax) ? '' : formCache.numberOfPax;
            }
            break;
        case 4:
            if (formCache.venue) {
                document.getElementById('venue-input').value = formCache.venue;
            }
            break;
        case 5:
            if (formCache.colorMotif) {
                document.getElementById('color-select').value = formCache.colorMotif;
            }
            break;
        case 6:
            if (formCache.package) {
                document.querySelectorAll('.package-choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.textContent.trim() === formCache.package) {
                        btn.classList.add('selected');
                        document.getElementById('package-next-btn').disabled = false;
                    }
                });
            }
            // Update package summary
            if (formCache.eventType && formCache.numberOfPax) {
                document.getElementById('package-summary').textContent = `${formCache.eventType} ${formCache.numberOfPax} Pax`;
            }
            break;
        case 7:
            // Restore food selections
            Object.keys(formCache.foodSelection).forEach(group => {
                const selections = formCache.foodSelection[group];
                selections.forEach(foodItem => {
                    document.querySelectorAll(`[data-group="${group}"] .food-btn`).forEach(btn => {
                        if (btn.textContent.trim() === foodItem) {
                            btn.classList.add('selected');
                        }
                    });
                });
            });
            break;
    }
}

function nextStep() {
    if (currentStep < totalSteps - 1) {
        showStep(currentStep + 1);
    }
}

function prevStep() {
    if (currentStep > 0) {
        showStep(currentStep - 1);
    }
}

// ============================================
//    STEP NAVIGATION (Progress Bar Clicks)
// ============================================

document.querySelectorAll('.step').forEach((step, index) => {
    step.addEventListener('click', () => {
        // Only allow navigation to completed steps or current step
        if (index <= currentStep || answers[index] !== null) {
            showStep(index);
        }
    });
});

// ============================================
//    BACK BUTTON HANDLERS
// ============================================

document.addEventListener('click', function(e) {
    if (e.target.classList.contains('back-btn')) {
        prevStep();
    }
});

// ============================================
//    STEP 0 - CELEBRANT NAME
// ============================================

document.getElementById('name-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.getElementById('celebrant-name').value.trim();
    if (!val) return showAlert('name', 'Please enter a name.');
    
    clearAlert('name');
    answers[0] = val;
    formCache.celebrantName = val;
    bookDetails.CustomerName = val;
    
    nextStep();
});

// ============================================
//    STEP 1 - DATE
// ============================================

document.getElementById('date-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.getElementById('date-picker').value;
    if (!val) {
        showAlert('date', 'Please choose a date.');
        return;
    }
    
    clearAlert('date');
    answers[1] = val;
    formCache.eventDate = val;
    bookDetails.Schedule = val;
    
    nextStep();
});

// ============================================
//    STEP 2 - EVENT TYPE
// ============================================

document.querySelectorAll('.event-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        clearAlert('event');
        
        // Remove selected class from all buttons
        document.querySelectorAll('.event-btn').forEach(b => b.classList.remove('selected'));
        
        // Add selected class to clicked button
        this.classList.add('selected');
        
        const eventType = this.textContent.trim();
        answers[2] = eventType;
        formCache.eventType = eventType;
        bookDetails.TypeOfEvent = eventType;
        
        // Enable next button
        document.getElementById('event-next-btn').disabled = false;
        
        // Clear custom input
        document.querySelector('.custom-event-input').value = '';
    });
});

document.getElementById('custom-event-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.querySelector('.custom-event-input').value.trim();
    if (!val) {
        showAlert('event', 'Please type a custom event name.');
        return;
    }
    
    clearAlert('event');
    
    // Remove selected class from preset buttons
    document.querySelectorAll('.event-btn').forEach(b => b.classList.remove('selected'));
    
    answers[2] = val;
    formCache.eventType = val;
    bookDetails.TypeOfEvent = val;
    
    // Enable next button
    document.getElementById('event-next-btn').disabled = false;
});

document.getElementById('event-next-btn').addEventListener('click', function() {
    if (!this.disabled) {
        nextStep();
    }
});

// ============================================
//    STEP 3 - PAX
// ============================================

document.getElementById('pax-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.getElementById('pax-select').value;
    if (!val) {
        showAlert('pax', 'Please select the number of guests.');
        return;
    }
    
    clearAlert('pax');
    answers[3] = val;
    formCache.numberOfPax = val;
    bookDetails.NumberOfPax = val;
    
    // Update package image
    document.getElementById('package_img').src = 'https://res.cloudinary.com/dzjrdqkiw/image/upload/v1749018729/wedding_170pax_wb3mcl.jpg';
    
    nextStep();
});

document.getElementById('custom-pax-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.querySelector('.custom-pax-input').value;
    if (!val) {
        showAlert('pax', 'Please type a custom number.');
        return;
    }
    
    clearAlert('pax');
    answers[3] = val;
    formCache.numberOfPax = val;
    bookDetails.NumberOfPax = val;
    
    // Clear select dropdown
    document.getElementById('pax-select').value = '';
    
    nextStep();
});

// ============================================
//    STEP 4 - LOCATION
// ============================================

const floorplanInput = document.getElementById('wizard-floorplan');
const floorplanPreview = document.getElementById('floorplan-preview');

floorplanInput.addEventListener('change', function() {
    const file = this.files[0];
    const venue = document.getElementById('venue-input').value.trim();
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            floorplanPreview.src = e.target.result;
            floorplanPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
        
        formCache.floorplan = file;
    }
    
    answers[4] = { venue: venue, floorplan: file };
    bookDetails.Location = { venue: venue, floorplan: file };
});

document.getElementById('location-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const venue = document.getElementById('venue-input').value.trim();
    const file = floorplanInput.files[0];
    
    if (!venue) return showAlert('location', 'Please enter a venue name.');
    
    clearAlert('location');
    
    answers[4] = { venue: venue, floorplan: file || null };
    formCache.venue = venue;
    if (file) formCache.floorplan = file;
    bookDetails.Location = { venue: venue, floorplan: file || null };
    
    nextStep();
});

// ============================================
//    STEP 5 - COLOR MOTIF
// ============================================

document.getElementById('color-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const val = document.getElementById('color-select').value;
    if (!val) {
        showAlert('color', 'Please pick a color.');
        return;
    }
    
    clearAlert('color');
    answers[5] = val;
    formCache.colorMotif = val;
    bookDetails.ColorMotif = val;
    
    nextStep();
});

// ============================================
//    STEP 6 - PACKAGE
// ============================================

document.querySelectorAll('.package-choice-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        clearAlert('package');
        
        // Remove selected class from all buttons
        document.querySelectorAll('.package-choice-btn').forEach(b => b.classList.remove('selected'));
        
        // Add selected class to clicked button
        this.classList.add('selected');
        
        const packageType = this.textContent.trim();
        answers[6] = packageType;
        formCache.package = packageType;
        bookDetails.Package = packageType;
        
        // Enable next button
        document.getElementById('package-next-btn').disabled = false;
    });
});

document.getElementById('package-next-btn').addEventListener('click', function() {
    if (!this.disabled) {
        nextStep();
    }
});

// ============================================
//    STEP 7 - FOOD MENU
// ============================================

document.querySelectorAll('.food-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const section = this.closest('.food-section');
        const group = section.dataset.group;
        const limit = parseInt(section.querySelector('.food-btn-group').dataset.limit);
        const groupBtns = section.querySelectorAll('.food-btn');
        const selectedInGroup = section.querySelectorAll('.food-btn.selected');
        
        if (this.classList.contains('selected')) {
            // Deselect
            this.classList.remove('selected');
        } else {
            // Select
            if (selectedInGroup.length >= limit) {
                // Remove oldest selection for groups with limits
                selectedInGroup[0].classList.remove('selected');
            }
            this.classList.add('selected');
        }
        
        // Update cached food selection
        const selectedFoods = Array.from(section.querySelectorAll('.food-btn.selected'))
                                   .map(btn => btn.textContent.trim());
        formCache.foodSelection[group] = selectedFoods;
    });
});

document.getElementById('foodmenu-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate food selection
    const allSelected = [];
    const pastaSelected = document.querySelectorAll('[data-group="pasta"] .food-btn.selected');
    const drinkSelected = document.querySelectorAll('[data-group="drink"] .food-btn.selected');
    
    document.querySelectorAll('.food-section').forEach(section => {
        const group = section.dataset.group;
        const selected = section.querySelectorAll('.food-btn.selected');
        
        if (group !== 'pasta' && group !== 'drink') {
            selected.forEach(btn => allSelected.push(btn.textContent.trim()));
        }
    });
    
    if (allSelected.length !== 4) {
        showAlert('food', 'Please select exactly 4 dishes.');
        return;
    }
    
    if (pastaSelected.length !== 1) {
        showAlert('food', 'Please select 1 pasta.');
        return;
    }
    
    if (drinkSelected.length !== 1) {
        showAlert('food', 'Please select 1 drink.');
        return;
    }
    
    clearAlert('food');
    
    // Prepare final submission
    const foodData = {
        dishes: allSelected,
        pasta: pastaSelected[0].textContent.trim(),
        drink: drinkSelected[0].textContent.trim()
    };
    
    answers[7] = foodData;
    bookDetails.ListOfFood = foodData;
    
    // Submit form
    submitBooking();
});

// ============================================
//    FINAL SUBMISSION
// ============================================

function submitBooking() {
    const payload = {
        name: answers[0],
        date: answers[1],
        event: answers[2],
        pax: answers[3],
        location: answers[4],
        color: answers[5],
        package: answers[6],
        food: {
            dishes: answers[7].dishes,
            pasta: answers[7].pasta,
            drink: answers[7].drink
        }
    };
    
    const formData = new FormData();
    formData.append("payload", JSON.stringify(payload));
    
    if (answers[4] && answers[4].floorplan) {
        formData.append("floorplan-payload", answers[4].floorplan);
    }
    
    fetch("{% url 'bookhere_submit' %}", {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: formData,
    }).then(response => {
        window.location.replace("/my_bookings");
    }).catch(error => {
        console.error('Submission error:', error);
        showAlert('food', 'There was an error submitting your booking. Please try again.');
    });
}

// ============================================
//    INITIALIZATION
// ============================================

// Start with step 0
showStep(0);

</script>

</body>
</html>
